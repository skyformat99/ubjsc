#!/bin/bash
USER=%USER%
HOMEDIR=%HOMEDIR%
PIDFILE=%PIDFILE%
PASSWD=%PASSWD%

start() {
        if test -f ${PIDFILE}
        then
            echo "ubjsc artifact server is already running!"
            exit 1
        fi

        echo -n "Starting ubjsc artifact server: "
        sudo -u ${USER} "${HOMEDIR}/server.py" &
        echo $! > ${PIDFILE}
        cat ${PIDFILE}
        echo "."
}

stop() {
        if ! test -f ${PIDFILE}
        then
            echo "ubjsc artifact server is not running!"
            exit 1
        fi

        echo -n "Stopping ubjsc artifact server: "
        cat ${PIDFILE}
        sudo kill $(cat ${PIDFILE})
        rm ${PIDFILE}
        echo "."
}

status() {
        test -f ${PIDFILE} && STATUS="is" || STATUS="is not"
        echo "ubjsc artifact server ${STATUS} running."
}

### main logic ###
case "$1" in
  start)
        start
        ;;
  stop)
        stop
        ;;
  status)
        status
        ;;
  restart|reload|condrestart)
        stop
        start
        ;;
  *)
        echo $"Usage: $0 {start|stop|restart|reload|status}"
        exit 1
esac

exit 0
